# SvitloBoard Firmware

**SvitloBoard** - це прошивка для ESP8266, яка дозволяє налаштувати пристрій для сповіщення про наявність світла через систему [СвітлоБот](https://svitlobot.in.ua).

## Зміст

- [Опис проекту](#опис-проекту)
- [Веб-інтерфейс](#веб-інтерфейс)
- [Функціональність](#функціональність)
- [Установка](#установка)
- [Використання](#використання)
- [Налаштування](#налаштування)
- [Внесок](#внесок)
- [Ліцензія](#ліцензія)
- [Known Issues](#known-issues)
- [TODO](#todo)

## Опис проекту

Ідея SvitloBoard полягає у створенні простого та зручного рішення для інтеграції з системою СвітлоБот, що дозволяє автоматично повідомляти про наявність світла.

## Веб-інтерфейс
![setup](https://github.com/user-attachments/assets/ac7de3c6-39fd-4ee9-ad62-49505e1f6eca)
![channel_key](https://github.com/user-attachments/assets/97ef9f16-f66d-4283-843c-aa5ab2e5e801)
![wifi](https://github.com/user-attachments/assets/3a816514-3790-4fea-91db-b3d18a09c51f)
![status](https://github.com/user-attachments/assets/8b42f446-78e8-44f3-9809-b458cda9b4fa)

**Увага:** Цей проект був протестований поки лише на контролері ESP8266 і є бета-версією, яка може містити помилки в роботі.

## Функціональність
- **Налаштування Channel Key**: Введення унікального коду каналу для підключення до СвітлоБот.
- **Налаштування мережі Wi-Fi**: Конфігурація основної та резервних мереж Wi-Fi через веб-інтерфейс.
- **Перевірка статусу**: Отримання інформації про запити до API СвітлоБот.
- **Скидання до заводських налаштувань**: Можливість скидання всіх налаштувань через веб-інтерфейс або через 4 послідовних ввімкнення/вимкнення.
- **Підключення до мережі**: Автоматичне підключення до першої доступної мережі. Є можливість вказувати до 2-х додаткових резервних точок Wi-Fi.
- **Точка доступу**: Пристрій працює як точка доступу за замовчуванням, якщо не задано мережу.

## Установка

1. Завантажте та встановіть [Arduino IDE](https://www.arduino.cc/en/software).
2. Додайте підтримку ESP8266 до Arduino IDE через Менеджер плат.
3. Завантажте цей репозиторій або склонуйте його:
    ```bash
    git clone https://github.com/Baskerville42/svitloboard.git
    ```
4. Відкрийте файл `svitloboard.ino` в Arduino IDE.
5. Підключіть ESP8266 до комп'ютера і виберіть відповідну плату та порт у меню "Інструменти".
6. Завантажте прошивку на ESP8266.

## Використання

1. **Підключення до точки доступу**: Пристрій автоматично створить точку доступу з SSID "SVITLOBOARD". Підключіться до цієї мережі з вашого пристрою.
2. **Налаштування через веб-інтерфейс**: Відкрийте веб-браузер і перейдіть за адресою `192.168.4.1`. Це відкриє сторінку налаштування.
3. **Введіть Channel Key та дані мережі Wi-Fi**: На сторінці налаштування введіть унікальний код каналу та дані для основної Wi-Fi мережі.
4. **Збережіть налаштування**: Натисніть "Зберегти" для збереження налаштувань. Пристрій автоматично перезавантажиться і спробує підключитися до нової мережі.

## Налаштування

Усі подальші налаштування будуть доступні за новою IP-адресою підключеної мережі.
1. **Знайти адресу пристрою**: У панелі керування (чи додатку) вашого пристрою Wi-Fi знайдіть список клієнтів. У цьому списку знайдіть SvitloBoard 1.0 та перегляньте його IP-адресу.
2. **Налаштування через веб-інтерфейс**: Відкрийте веб-браузер і перейдіть за адресою з попереднього кроку. Це відкриє сторінку налаштування.

## Внесок

Внесок до проекту вітається! Якщо ви хочете внести зміни, будь ласка, створіть pull request або відкрийте issue для обговорення змін.

## Ліцензія

Цей проект ліцензується під ліцензією MIT - подробиці дивіться у файлі [LICENSE](LICENSE).

## Known Issues

Перед використанням цієї прошивки варто очистити пам'ять EEPROM, інакше можуть бути проблеми в 
роботі. Як тимчасове рішення - можна скинути пристрій після прошивки 4-ма послідовними 
увімкненнями та вимкненнями.
```
↑ ↓ (чекаємо 2 секунди) ↑ ↓ (чекаємо 2 секунди) ↑ ↓ (чекаємо 2 секунди) ↑ ↓ (очікуйте 
декілька секунд)
```
На цьому етапі значення Boot count у моніторі порта має стати 4, і відразу відбудеться 
перезавантаження. Це означатиме, що пристрій очистив пам'ять. 
([Issue#2](https://github.com/Baskerville42/svitloboard/issues/2))

Можливі проблеми в роботі на інших мікроконтролерах, відмінних від ESP8266 (ESP-01).

Якщо раптом мікроконтролер перестав посилати запити, але підключається до мережі і веб-інтерфейс доступний - можливо на сервері змінився https сертифікат і потрібно змінити його в файлі [channel_ping_request.cpp](https://github.com/Baskerville42/svitloboard/blob/main/channel_ping_request.cpp#L13).

## TODO

- [x] Реалізувати переключення між основною та резервними мережами WiFi
- [x] Скидання пристрою через 4 послідовних вимкнення та увімкнення
- [ ] Можливість вказувати кастомний URL для інтервальних запитів в 1 хв
- [ ] Очищувати EEPROM при першому увімкненні до ініціалізації читання конфігурації
- [ ] Можливість змінювати Fingerprint сертифікату сервера API
- [ ] Видалення збережених резервних мереж
- [ ] Можливість поставити запити до СвітлоБот на технічну паузу

---

**Автор**: Alexander Tartmin  
**GitHub**: [baskerville42](https://github.com/baskerville42)
